<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flag Guessing Game</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2rem; }
    img { width: 50vw; height: auto; border: 1px solid #ccc; }
    input { padding: .5rem; font-size: 1rem; }
    button { padding: .5rem 1rem; margin-left: .5rem; }
    p#feedback { font-weight: bold; margin-top: 1rem; color: inherit; }
  </style>
</head>
<body>
  <h1>Guess the Country</h1>
  <img id="flag" src="" alt="Country Flag">
  <div>
    <input id="guess" placeholder="Type country name…">
    <button id="submit">Submit</button>
  </div>
  <p id="feedback"></p>
  <div id="details" style="margin-top:0.5rem; color: #555;"></div>
  <script src="./countries.js"></script>
  <script>
    let current;

    function pickRandom() {
      current = countries[Math.floor(Math.random() * countries.length)];
      document.getElementById('flag').src = current.flagUrl;
      document.getElementById('feedback').textContent = '';
      document.getElementById('guess').value = '';
      document.getElementById('guess').focus();
    }

    // 2. Levenshtein distance
    function levenshtein(a, b) {
      const m = a.length, n = b.length;
      const dp = Array.from({length: m+1}, () => Array(n+1).fill(0));
      for (let i = 0; i <= m; i++) dp[i][0] = i;
      for (let j = 0; j <= n; j++) dp[0][j] = j;
      for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
          dp[i][j] = Math.min(
            dp[i-1][j] + 1,
            dp[i][j-1] + 1,
            dp[i-1][j-1] + (a[i-1] === b[j-1] ? 0 : 1)
          );
        }
      }
      return dp[m][n];
    }

    document.getElementById('submit').addEventListener('click', () => {
      const input = document.getElementById('guess').value.trim().toLowerCase();
      // compute distances to each valid name
      const distances = current.names.map(name =>
        levenshtein(input, name.toLowerCase())
      );
      const distance = Math.min(...distances);
      const ok = distance <= 2;

      const feedbackEl = document.getElementById('feedback');
      feedbackEl.textContent = ok ? '✔️ Correct!' : '❌ Try again…';
      feedbackEl.style.color   = ok ? 'green'       : 'red';
      document.getElementById('details').textContent =
        `Answer: ${current.names[0]}, Input: ${input}, Distance: ${distance}`;

      if (ok) setTimeout(pickRandom, 1000);
    });

    // allow Enter key in input to trigger submit
    document.getElementById('guess').addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('submit').click();
      }
    });

    // Initialize
    pickRandom();
  </script>
</body>
</html>